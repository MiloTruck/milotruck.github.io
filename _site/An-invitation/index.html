<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.6 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>An invitation [981] - Home</title>
<meta name="description" content="Category: WebChallenge Description  We want you to be a member of the Cyber Defense Group! Your invitation has been encoded to avoid being detected by COViD’s sensors. Decipher the invitation and join in the fight!Starting offLooking at index.html, we open it in the browser, but nothing seems to show up on the page. We view the browser console to see an undefined variable error message in invite.js, imported through a &lt;script&gt; tag. For jquery-led.js, it appears as decently well written and formatted code, with the author credited and license mentioned as well. After a little Googling, we quickly discover that it is an open-source plug-in, here. We can conclude these are likely not needed to be reversed, and instead it is invite.js that does, being related to the challenge name as well.Breaking down invite.jsRather than handling the mess of obfuscation entirely manually, we can put it into an automatic formatter. For JavaScript, we can just use beautifier.io. The beautified code looks like this:try {    canvas = document[&#39;querySelector&#39;](&#39;.G&#39;);    gl = canvas[&#39;getContext&#39;](&#39;webgl&#39;);    gl[&#39;clearColor&#39;](0.0, 0.0, 0.0, 1.0);    gl[&#39;clear&#39;](gl.COLOR_BUFFER_BIT);    shade = canvas[&#39;getAttribute&#39;](&#39;shade&#39;);    ctype = canvas[&#39;getAttribute&#39;](&#39;type&#39;);    cid = canvas[&#39;getAttribute&#39;](&#39;id&#39;)[&#39;slice&#39;](5, 7);    gl[&#39;KG&#39;] = window[shade + cid + ctype];} catch (err) {}var _0x55f3 = [&#39;||||||function|var||hhh||||for|charCodeAt|if|length|eee||uuu||mmm|||custom|fromCharCode|String|vvv||ggg|location|catLED|type||color||rounded|font_type|background_color|e0e0e0|size|return|zzz|FF0000|value|seed|yyy|rrr||ooo|slice|ttt|false|window|else|you|iii|let|YOU||compare|0xff|||23|re|hostname|console|||57|protocol|file|54|log|max|Math|98|requestAnimationFrame|true|0BB|00|88|09|0FZ|02|0D|06HD|03S|31|get|new|Image|Object|defineProperty|id|unescape|invited|2000|pathname|const|ech||setTimeout|WANT|WE|custom3|custom2|INVITED|RE|custom1|debugger|1000|invite|the|accepting|alert|Thank|indexOf|go|118|3V3jYanBpfDq5QAb7OMCcT|leaHVWaWLfhj4|atob&#39;, &#39;toString&#39;, &#39;replace&#39;, &#39;x=[0,0,0];1C Y=(a,b)=&gt;{V s=\&#39;\&#39;;d(V i=0;i&lt;1e.1d(a.g,b.g);i++){s+=q.p((a.e(i)||0)^(b.e(i)||0))}F s};f(u.19==\&#39;1a:\&#39;){x[0]=12}S{x[0]=18}f(Y(R.u.14,&quot;T\&#39;13 1z!!!&quot;)==1y(&quot;%1E%1j%1q%17%1p%1o%1n%1m%1l%1i@M&quot;)){x[1]=1k}S{x[1]=1r}6 K(){7 j=Q;7 G=1t 1u();1v.1w(G,\&#39;1x\&#39;,{1s:6(){j=1h;x[2]=1b}});1g(6 X(){j=Q;15.1c(&quot;%c&quot;,G);f(!j){x[2]=1f}})};K();6 N(J){7 m=Z;7 a=11;7 c=17;7 z=J||3;F 6(){z=(a*z+c)%m;F z}}6 U(h){P=h[0]&lt;&lt;16|h[1]&lt;&lt;8|h[2];L=N(P);t=R.u.1B.O(1);9=&quot;&quot;;d(i=0;i&lt;t.g;i++){9+=q.p(t.e(i)-1)}r=1Z(&quot;1X//k/1Y=&quot;);l=&quot;&quot;;f(9.O(0,2)==&quot;1V&quot;&amp;&amp;9.e(2)==1W&amp;&amp;9.1U(\&#39;1D-c\&#39;)==4){d(i=0;i&lt;r.g;i++){l+=q.p(r.e(i)^L())}1S(&quot;1T T d 1R 1Q 1P!\n&quot;+9+l)}}d(a=0;a!=1O;a++){1N}$(\&#39;.1M\&#39;).v({w:\&#39;o\&#39;,y:\&#39;#H\&#39;,C:\&#39;#D\&#39;,E:10,A:5,B:4,I:&quot; W\&#39;1L 1K! &quot;});$(\&#39;.1J\&#39;).v({w:\&#39;o\&#39;,y:\&#39;#H\&#39;,C:\&#39;#D\&#39;,E:10,A:5,B:4,I:&quot;                 &quot;});$(\&#39;.1I\&#39;).v({w:\&#39;o\&#39;,y:\&#39;#H\&#39;,C:\&#39;#D\&#39;,E:10,A:5,B:4,I:&quot;   1H 1G W!  &quot;});1F(6(){U(x)},1A);&#39;, &#39;\w+&#39;];(function(_0x92e4x2, _0x92e4x3) {    var _0x92e4x4 = function(_0x92e4x5) {        while (--_0x92e4x5) {            _0x92e4x2[&#39;push&#39;](_0x92e4x2[&#39;shift&#39;]());        }    };    _0x92e4x4(++_0x92e4x3);}(_0x55f3, 0x65));var _0x3db8 = function(_0x92e4x2, _0x92e4x3) {    _0x92e4x2 = _0x92e4x2 - 0x0;    var _0x92e4x4 = _0x55f3[_0x92e4x2];    return _0x92e4x4;};var _0x27631a = _0x3db8;gl[&#39;KG&#39;](function(_0x92e4x5, _0x92e4x8, _0x92e4x9, _0x92e4xa, _0x92e4xb, _0x92e4xc) {    var _0x92e4xd = _0x3db8;    _0x92e4xb = function(_0x92e4xe) {        var _0x92e4xf = _0x3db8;        return (_0x92e4xe &lt; _0x92e4x8 ? &#39;&#39; : _0x92e4xb(parseInt(_0x92e4xe / _0x92e4x8))) + ((_0x92e4xe = _0x92e4xe % _0x92e4x8) &gt; 0x23 ? String[&#39;fromCharCode&#39;](_0x92e4xe + 0x1d) : _0x92e4xe[_0x92e4xf(&#39;0x0&#39;)](0x24));    };    if (!&#39;&#39; [_0x92e4xd(&#39;0x1&#39;)](/^/, String)) {        while (_0x92e4x9--) {            _0x92e4xc[_0x92e4xb(_0x92e4x9)] = _0x92e4xa[_0x92e4x9] || _0x92e4xb(_0x92e4x9);        }        _0x92e4xa = [function(_0x92e4x10) {            return _0x92e4xc[_0x92e4x10];        }], _0x92e4xb = function() {            var _0x92e4x11 = _0x92e4xd;            return _0x92e4x11(&#39;0x3&#39;);        }, _0x92e4x9 = 0x1;    };    while (_0x92e4x9--) {        _0x92e4xa[_0x92e4x9] &amp;&amp; (_0x92e4x5 = _0x92e4x5[_0x92e4xd(&#39;0x1&#39;)](new RegExp(&#39;\b&#39; + _0x92e4xb(_0x92e4x9) + &#39;\b&#39;, &#39;g&#39;), _0x92e4xa[_0x92e4x9]));    }    return _0x92e4x5;}(_0x27631a(&#39;0x2&#39;), 0x3e, 0x7c, _0x27631a(&#39;0x4&#39;)[&#39;split&#39;](&#39;|&#39;), 0x0, {}));Other than formatting the code, the beautifier also did some variable substitutions for us, saving us some effort. To summarise what the code does:  try setting gl.KG to a global window variable  declare a (rather large) string array variable _0x55f3  some array methods on the above string array  declare a helper function, assigned to both _0x3db8 and _0x27631a  call gl.KG as a function on an IIFE (immediately-invoked function expression)The undefined variable error found in the browser console when opening index.html, is in fact for gl, which means the try block had failed. The attributes of some elements provided in DOM (Document Object Model) of index.html don’t match up exactly with what invite.js requires. As there are only a limited number of possible global functions, in window, we can try to figure out what the function gl.KG was intended to be. A good way to do this is to look into the IIFE that was called as the argument of gl.KG.Analysing the IIFEBefore starting, we remove the try block, and put the IIFE into console.log, so we can run the Javscript as we wish. Rather than analysing from top to bottom, we trace backwards starting from the return value, _0x92e4x5. The only places that this variable appears in the IIFE are as the first parameter, in an assignment in the while loop just before returning, and of course in the return value itself. We don’t need to deal with the rest of the IIFE. (Though note that during the actual CTF, I did reverse much more of the code to get a good handle on what it really does.)With a little console.log-ing, we find that the while loop runs for exactly one iteration, and the assignment of _0x92e4x5 does occur. The .replace(regex, callback) method on String.prototype is called on the string _0x92e4x5. The intended regex takes word bounds, &#39;\b&#39; from the argument of the RegExp constructor, and the &#39;\w+&#39; from the string array, with a global flag &#39;g&#39;, forming the regex /\b\w+\b/. However, one well-known caveat of the RegExp constructor, from past experience dealing with JavaScript regexes, is the escaping. The backslashes on the word bound \b and word character \w character classes, would appear in the raw regex literal, they would have to be escaped (as \\) when in a string passed to the RegExp constructor. Simply inserting this double backslash in all three places, and running the code again, we have the argument passed to the IIFE:x=[0,0,0];const compare=(a,b)=&gt;{let s=&#39;&#39;;for(let i=0;i&lt;Math.max(a.length,b.length);i++){s+=String.fromCharCode((a.charCodeAt(i)||0)^(b.charCodeAt(i)||0))}return s};if(location.protocol==&#39;file:&#39;){x[0]=23}else{x[0]=57}if(compare(window.location.hostname,&quot;you&#39;re invited!!!&quot;)==unescape(&quot;%1E%00%03S%17%06HD%0D%02%0FZ%09%0BB@M&quot;)){x[1]=88}else{x[1]=31}function yyy(){var uuu=false;var zzz=new Image();Object.defineProperty(zzz,&#39;id&#39;,{get:function(){uuu=true;x[2]=54}});requestAnimationFrame(function X(){uuu=false;console.log(&quot;%c&quot;,zzz);if(!uuu){x[2]=98}})};yyy();function ooo(seed){var m=0xff;var a=11;var c=17;var z=seed||3;return function(){z=(a*z+c)%m;return z}}function iii(eee){ttt=eee[0]&lt;&lt;16|eee[1]&lt;&lt;8|eee[2];rrr=ooo(ttt);ggg=window.location.pathname.slice(1);hhh=&quot;&quot;;for(i=0;i&lt;ggg.length;i++){hhh+=String.fromCharCode(ggg.charCodeAt(i)-1)}vvv=atob(&quot;3V3jYanBpfDq5QAb7OMCcT//k/leaHVWaWLfhj4=&quot;);mmm=&quot;&quot;;if(hhh.slice(0,2)==&quot;go&quot;&amp;&amp;hhh.charCodeAt(2)==118&amp;&amp;hhh.indexOf(&#39;ech-c&#39;)==4){for(i=0;i&lt;vvv.length;i++){mmm+=String.fromCharCode(vvv.charCodeAt(i)^rrr())}alert(&quot;Thank you for accepting the invite!&quot;+hhh+mmm)}}for(a=0;a!=1000;a++){debugger}$(&#39;.custom1&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot; YOU&#39;RE INVITED! &quot;});$(&#39;.custom2&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;                 &quot;});$(&#39;.custom3&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;   WE WANT YOU!  &quot;});setTimeout(function(){iii(x)},2000);Now it would be sufficiently clear: This is more JavaScript code; the global function gl.KG that we want is just eval(). In the browser console, it merely gives a decoration on the page, and pauses midway in the debugger. Removing the debugger statement, a message appears through the jquery-led.js plug-in - but still no sign of the flag. Perhaps we need to take a closer look at the code rather than a cursory skim. Again, into beautifier.io it goes.x = [0, 0, 0];const compare = (a, b) =&gt; {    let s = &#39;&#39;;    for (let i = 0; i &lt; Math.max(a.length, b.length); i++) {        s += String.fromCharCode((a.charCodeAt(i) || 0) ^ (b.charCodeAt(i) || 0));    }    return s;};if (location.protocol == &#39;file:&#39;) {    x[0] = 23;} else {    x[0] = 57;}if (compare(window.location.hostname, &quot;you&#39;re invited!!!&quot;) == unescape(&quot;%1E%00%03S%17%06HD%0D%02%0FZ%09%0BB@M&quot;)) {    x[1] = 88;} else {    x[1] = 31;}function yyy() {    var uuu = false;    var zzz = new Image();    Object.defineProperty(zzz, &#39;id&#39;, {        get: function() {            uuu = true;            x[2] = 54;        }    });    requestAnimationFrame(function X() {        uuu = false;        console.log(&quot;%c&quot;, zzz);        if (!uuu) {            x[2] = 98;        }    })};yyy();function ooo(seed) {    var m = 0xff;    var a = 11;    var c = 17;    var z = seed || 3;    return function() {        z = (a * z + c) % m;        return z;    }}function iii(eee) {    ttt = eee[0] &lt;&lt; 16 | eee[1] &lt;&lt; 8 | eee[2];    rrr = ooo(ttt);    ggg = window.location.pathname.slice(1);    hhh = &quot;&quot;;    for (i = 0; i &lt; ggg.length; i++) {        hhh += String.fromCharCode(ggg.charCodeAt(i) - 1)    }    vvv = atob(&quot;3V3jYanBpfDq5QAb7OMCcT//k/leaHVWaWLfhj4=&quot;);    mmm = &quot;&quot;;    if (hhh.slice(0, 2) == &quot;go&quot; &amp;&amp; hhh.charCodeAt(2) == 118 &amp;&amp; hhh.indexOf(&#39;ech-c&#39;) == 4) {        for (i = 0; i &lt; vvv.length; i++) {            mmm += String.fromCharCode(vvv.charCodeAt(i) ^ rrr())        }        alert(&quot;Thank you for accepting the invite!&quot;+hhh+mmm);    }}// for(a=0;a!=1000;a++) { debugger }$(&#39;.custom1&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;YOU &#39;RE INVITED! &quot;});$(&#39;.custom2&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;                 &quot;});$(&#39;.custom3&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;   WE WANT YOU!  &quot;});setTimeout(function(){iii(x)},2000);This time it is helpful to go through the code progressively. First a length 3 array x[] has its elements assigned:  x[0] is set to 23 or 57  x[1] is set to 88 or 31  x[2] is set to 54 or 98The function iii() is called on the array x[] through a setTimeout(). Within it, we see an alert() that gives user interaction, we can expect that this is where we finish, and get the flag, so we seek to find the values of hhh and mmm. For hhh, a check is performed to ensure it starts with &quot;gov*ech-c&quot; where the asterisk is any character. This is just part of the flag format, so the important bit comes from mmm. We can remove the parts involving hhh and ggg, then run the code on each of the 8 possible arrays x[], console.log-ing the value of mmm each time. The array [57,88,54] is the only one that gives a readable string for mmm: {gr33tz_w3LC0m3_2_dA_t3@m_m8}Flag: govtech-csg{gr33tz_w3LC0m3_2_dA_t3@m_m8}">


  <meta name="author" content="MiloTruck">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Home">
<meta property="og:title" content="An invitation [981]">
<meta property="og:url" content="http://localhost:4000/An-invitation/">


  <meta property="og:description" content="Category: WebChallenge Description  We want you to be a member of the Cyber Defense Group! Your invitation has been encoded to avoid being detected by COViD’s sensors. Decipher the invitation and join in the fight!Starting offLooking at index.html, we open it in the browser, but nothing seems to show up on the page. We view the browser console to see an undefined variable error message in invite.js, imported through a &lt;script&gt; tag. For jquery-led.js, it appears as decently well written and formatted code, with the author credited and license mentioned as well. After a little Googling, we quickly discover that it is an open-source plug-in, here. We can conclude these are likely not needed to be reversed, and instead it is invite.js that does, being related to the challenge name as well.Breaking down invite.jsRather than handling the mess of obfuscation entirely manually, we can put it into an automatic formatter. For JavaScript, we can just use beautifier.io. The beautified code looks like this:try {    canvas = document[&#39;querySelector&#39;](&#39;.G&#39;);    gl = canvas[&#39;getContext&#39;](&#39;webgl&#39;);    gl[&#39;clearColor&#39;](0.0, 0.0, 0.0, 1.0);    gl[&#39;clear&#39;](gl.COLOR_BUFFER_BIT);    shade = canvas[&#39;getAttribute&#39;](&#39;shade&#39;);    ctype = canvas[&#39;getAttribute&#39;](&#39;type&#39;);    cid = canvas[&#39;getAttribute&#39;](&#39;id&#39;)[&#39;slice&#39;](5, 7);    gl[&#39;KG&#39;] = window[shade + cid + ctype];} catch (err) {}var _0x55f3 = [&#39;||||||function|var||hhh||||for|charCodeAt|if|length|eee||uuu||mmm|||custom|fromCharCode|String|vvv||ggg|location|catLED|type||color||rounded|font_type|background_color|e0e0e0|size|return|zzz|FF0000|value|seed|yyy|rrr||ooo|slice|ttt|false|window|else|you|iii|let|YOU||compare|0xff|||23|re|hostname|console|||57|protocol|file|54|log|max|Math|98|requestAnimationFrame|true|0BB|00|88|09|0FZ|02|0D|06HD|03S|31|get|new|Image|Object|defineProperty|id|unescape|invited|2000|pathname|const|ech||setTimeout|WANT|WE|custom3|custom2|INVITED|RE|custom1|debugger|1000|invite|the|accepting|alert|Thank|indexOf|go|118|3V3jYanBpfDq5QAb7OMCcT|leaHVWaWLfhj4|atob&#39;, &#39;toString&#39;, &#39;replace&#39;, &#39;x=[0,0,0];1C Y=(a,b)=&gt;{V s=\&#39;\&#39;;d(V i=0;i&lt;1e.1d(a.g,b.g);i++){s+=q.p((a.e(i)||0)^(b.e(i)||0))}F s};f(u.19==\&#39;1a:\&#39;){x[0]=12}S{x[0]=18}f(Y(R.u.14,&quot;T\&#39;13 1z!!!&quot;)==1y(&quot;%1E%1j%1q%17%1p%1o%1n%1m%1l%1i@M&quot;)){x[1]=1k}S{x[1]=1r}6 K(){7 j=Q;7 G=1t 1u();1v.1w(G,\&#39;1x\&#39;,{1s:6(){j=1h;x[2]=1b}});1g(6 X(){j=Q;15.1c(&quot;%c&quot;,G);f(!j){x[2]=1f}})};K();6 N(J){7 m=Z;7 a=11;7 c=17;7 z=J||3;F 6(){z=(a*z+c)%m;F z}}6 U(h){P=h[0]&lt;&lt;16|h[1]&lt;&lt;8|h[2];L=N(P);t=R.u.1B.O(1);9=&quot;&quot;;d(i=0;i&lt;t.g;i++){9+=q.p(t.e(i)-1)}r=1Z(&quot;1X//k/1Y=&quot;);l=&quot;&quot;;f(9.O(0,2)==&quot;1V&quot;&amp;&amp;9.e(2)==1W&amp;&amp;9.1U(\&#39;1D-c\&#39;)==4){d(i=0;i&lt;r.g;i++){l+=q.p(r.e(i)^L())}1S(&quot;1T T d 1R 1Q 1P!\n&quot;+9+l)}}d(a=0;a!=1O;a++){1N}$(\&#39;.1M\&#39;).v({w:\&#39;o\&#39;,y:\&#39;#H\&#39;,C:\&#39;#D\&#39;,E:10,A:5,B:4,I:&quot; W\&#39;1L 1K! &quot;});$(\&#39;.1J\&#39;).v({w:\&#39;o\&#39;,y:\&#39;#H\&#39;,C:\&#39;#D\&#39;,E:10,A:5,B:4,I:&quot;                 &quot;});$(\&#39;.1I\&#39;).v({w:\&#39;o\&#39;,y:\&#39;#H\&#39;,C:\&#39;#D\&#39;,E:10,A:5,B:4,I:&quot;   1H 1G W!  &quot;});1F(6(){U(x)},1A);&#39;, &#39;\w+&#39;];(function(_0x92e4x2, _0x92e4x3) {    var _0x92e4x4 = function(_0x92e4x5) {        while (--_0x92e4x5) {            _0x92e4x2[&#39;push&#39;](_0x92e4x2[&#39;shift&#39;]());        }    };    _0x92e4x4(++_0x92e4x3);}(_0x55f3, 0x65));var _0x3db8 = function(_0x92e4x2, _0x92e4x3) {    _0x92e4x2 = _0x92e4x2 - 0x0;    var _0x92e4x4 = _0x55f3[_0x92e4x2];    return _0x92e4x4;};var _0x27631a = _0x3db8;gl[&#39;KG&#39;](function(_0x92e4x5, _0x92e4x8, _0x92e4x9, _0x92e4xa, _0x92e4xb, _0x92e4xc) {    var _0x92e4xd = _0x3db8;    _0x92e4xb = function(_0x92e4xe) {        var _0x92e4xf = _0x3db8;        return (_0x92e4xe &lt; _0x92e4x8 ? &#39;&#39; : _0x92e4xb(parseInt(_0x92e4xe / _0x92e4x8))) + ((_0x92e4xe = _0x92e4xe % _0x92e4x8) &gt; 0x23 ? String[&#39;fromCharCode&#39;](_0x92e4xe + 0x1d) : _0x92e4xe[_0x92e4xf(&#39;0x0&#39;)](0x24));    };    if (!&#39;&#39; [_0x92e4xd(&#39;0x1&#39;)](/^/, String)) {        while (_0x92e4x9--) {            _0x92e4xc[_0x92e4xb(_0x92e4x9)] = _0x92e4xa[_0x92e4x9] || _0x92e4xb(_0x92e4x9);        }        _0x92e4xa = [function(_0x92e4x10) {            return _0x92e4xc[_0x92e4x10];        }], _0x92e4xb = function() {            var _0x92e4x11 = _0x92e4xd;            return _0x92e4x11(&#39;0x3&#39;);        }, _0x92e4x9 = 0x1;    };    while (_0x92e4x9--) {        _0x92e4xa[_0x92e4x9] &amp;&amp; (_0x92e4x5 = _0x92e4x5[_0x92e4xd(&#39;0x1&#39;)](new RegExp(&#39;\b&#39; + _0x92e4xb(_0x92e4x9) + &#39;\b&#39;, &#39;g&#39;), _0x92e4xa[_0x92e4x9]));    }    return _0x92e4x5;}(_0x27631a(&#39;0x2&#39;), 0x3e, 0x7c, _0x27631a(&#39;0x4&#39;)[&#39;split&#39;](&#39;|&#39;), 0x0, {}));Other than formatting the code, the beautifier also did some variable substitutions for us, saving us some effort. To summarise what the code does:  try setting gl.KG to a global window variable  declare a (rather large) string array variable _0x55f3  some array methods on the above string array  declare a helper function, assigned to both _0x3db8 and _0x27631a  call gl.KG as a function on an IIFE (immediately-invoked function expression)The undefined variable error found in the browser console when opening index.html, is in fact for gl, which means the try block had failed. The attributes of some elements provided in DOM (Document Object Model) of index.html don’t match up exactly with what invite.js requires. As there are only a limited number of possible global functions, in window, we can try to figure out what the function gl.KG was intended to be. A good way to do this is to look into the IIFE that was called as the argument of gl.KG.Analysing the IIFEBefore starting, we remove the try block, and put the IIFE into console.log, so we can run the Javscript as we wish. Rather than analysing from top to bottom, we trace backwards starting from the return value, _0x92e4x5. The only places that this variable appears in the IIFE are as the first parameter, in an assignment in the while loop just before returning, and of course in the return value itself. We don’t need to deal with the rest of the IIFE. (Though note that during the actual CTF, I did reverse much more of the code to get a good handle on what it really does.)With a little console.log-ing, we find that the while loop runs for exactly one iteration, and the assignment of _0x92e4x5 does occur. The .replace(regex, callback) method on String.prototype is called on the string _0x92e4x5. The intended regex takes word bounds, &#39;\b&#39; from the argument of the RegExp constructor, and the &#39;\w+&#39; from the string array, with a global flag &#39;g&#39;, forming the regex /\b\w+\b/. However, one well-known caveat of the RegExp constructor, from past experience dealing with JavaScript regexes, is the escaping. The backslashes on the word bound \b and word character \w character classes, would appear in the raw regex literal, they would have to be escaped (as \\) when in a string passed to the RegExp constructor. Simply inserting this double backslash in all three places, and running the code again, we have the argument passed to the IIFE:x=[0,0,0];const compare=(a,b)=&gt;{let s=&#39;&#39;;for(let i=0;i&lt;Math.max(a.length,b.length);i++){s+=String.fromCharCode((a.charCodeAt(i)||0)^(b.charCodeAt(i)||0))}return s};if(location.protocol==&#39;file:&#39;){x[0]=23}else{x[0]=57}if(compare(window.location.hostname,&quot;you&#39;re invited!!!&quot;)==unescape(&quot;%1E%00%03S%17%06HD%0D%02%0FZ%09%0BB@M&quot;)){x[1]=88}else{x[1]=31}function yyy(){var uuu=false;var zzz=new Image();Object.defineProperty(zzz,&#39;id&#39;,{get:function(){uuu=true;x[2]=54}});requestAnimationFrame(function X(){uuu=false;console.log(&quot;%c&quot;,zzz);if(!uuu){x[2]=98}})};yyy();function ooo(seed){var m=0xff;var a=11;var c=17;var z=seed||3;return function(){z=(a*z+c)%m;return z}}function iii(eee){ttt=eee[0]&lt;&lt;16|eee[1]&lt;&lt;8|eee[2];rrr=ooo(ttt);ggg=window.location.pathname.slice(1);hhh=&quot;&quot;;for(i=0;i&lt;ggg.length;i++){hhh+=String.fromCharCode(ggg.charCodeAt(i)-1)}vvv=atob(&quot;3V3jYanBpfDq5QAb7OMCcT//k/leaHVWaWLfhj4=&quot;);mmm=&quot;&quot;;if(hhh.slice(0,2)==&quot;go&quot;&amp;&amp;hhh.charCodeAt(2)==118&amp;&amp;hhh.indexOf(&#39;ech-c&#39;)==4){for(i=0;i&lt;vvv.length;i++){mmm+=String.fromCharCode(vvv.charCodeAt(i)^rrr())}alert(&quot;Thank you for accepting the invite!&quot;+hhh+mmm)}}for(a=0;a!=1000;a++){debugger}$(&#39;.custom1&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot; YOU&#39;RE INVITED! &quot;});$(&#39;.custom2&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;                 &quot;});$(&#39;.custom3&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;   WE WANT YOU!  &quot;});setTimeout(function(){iii(x)},2000);Now it would be sufficiently clear: This is more JavaScript code; the global function gl.KG that we want is just eval(). In the browser console, it merely gives a decoration on the page, and pauses midway in the debugger. Removing the debugger statement, a message appears through the jquery-led.js plug-in - but still no sign of the flag. Perhaps we need to take a closer look at the code rather than a cursory skim. Again, into beautifier.io it goes.x = [0, 0, 0];const compare = (a, b) =&gt; {    let s = &#39;&#39;;    for (let i = 0; i &lt; Math.max(a.length, b.length); i++) {        s += String.fromCharCode((a.charCodeAt(i) || 0) ^ (b.charCodeAt(i) || 0));    }    return s;};if (location.protocol == &#39;file:&#39;) {    x[0] = 23;} else {    x[0] = 57;}if (compare(window.location.hostname, &quot;you&#39;re invited!!!&quot;) == unescape(&quot;%1E%00%03S%17%06HD%0D%02%0FZ%09%0BB@M&quot;)) {    x[1] = 88;} else {    x[1] = 31;}function yyy() {    var uuu = false;    var zzz = new Image();    Object.defineProperty(zzz, &#39;id&#39;, {        get: function() {            uuu = true;            x[2] = 54;        }    });    requestAnimationFrame(function X() {        uuu = false;        console.log(&quot;%c&quot;, zzz);        if (!uuu) {            x[2] = 98;        }    })};yyy();function ooo(seed) {    var m = 0xff;    var a = 11;    var c = 17;    var z = seed || 3;    return function() {        z = (a * z + c) % m;        return z;    }}function iii(eee) {    ttt = eee[0] &lt;&lt; 16 | eee[1] &lt;&lt; 8 | eee[2];    rrr = ooo(ttt);    ggg = window.location.pathname.slice(1);    hhh = &quot;&quot;;    for (i = 0; i &lt; ggg.length; i++) {        hhh += String.fromCharCode(ggg.charCodeAt(i) - 1)    }    vvv = atob(&quot;3V3jYanBpfDq5QAb7OMCcT//k/leaHVWaWLfhj4=&quot;);    mmm = &quot;&quot;;    if (hhh.slice(0, 2) == &quot;go&quot; &amp;&amp; hhh.charCodeAt(2) == 118 &amp;&amp; hhh.indexOf(&#39;ech-c&#39;) == 4) {        for (i = 0; i &lt; vvv.length; i++) {            mmm += String.fromCharCode(vvv.charCodeAt(i) ^ rrr())        }        alert(&quot;Thank you for accepting the invite!&quot;+hhh+mmm);    }}// for(a=0;a!=1000;a++) { debugger }$(&#39;.custom1&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;YOU &#39;RE INVITED! &quot;});$(&#39;.custom2&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;                 &quot;});$(&#39;.custom3&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;   WE WANT YOU!  &quot;});setTimeout(function(){iii(x)},2000);This time it is helpful to go through the code progressively. First a length 3 array x[] has its elements assigned:  x[0] is set to 23 or 57  x[1] is set to 88 or 31  x[2] is set to 54 or 98The function iii() is called on the array x[] through a setTimeout(). Within it, we see an alert() that gives user interaction, we can expect that this is where we finish, and get the flag, so we seek to find the values of hhh and mmm. For hhh, a check is performed to ensure it starts with &quot;gov*ech-c&quot; where the asterisk is any character. This is just part of the flag format, so the important bit comes from mmm. We can remove the parts involving hhh and ggg, then run the code on each of the 8 possible arrays x[], console.log-ing the value of mmm each time. The array [57,88,54] is the only one that gives a readable string for mmm: {gr33tz_w3LC0m3_2_dA_t3@m_m8}Flag: govtech-csg{gr33tz_w3LC0m3_2_dA_t3@m_m8}">







  <meta property="article:published_time" content="2020-12-12T00:00:00+08:00">





  

  


<link rel="canonical" href="http://localhost:4000/An-invitation/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "MiloTruck",
      "url": "http://localhost:4000/"
    
  }
</script>


  <meta name="google-site-verification" content="_tE-Yah0HQSRNng0bITIKhyyOoGrbpidFdmZFnKylks" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Home Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/Favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/Favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/Favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/images/Favicon/site.webmanifest">
<link rel="mask-icon" href="/assets/images/Favicon/safari-pinned-tab.svg" color="#636363">
<link rel="shortcut icon" href="/assets/images/Favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-config" content="/assets/images/Favicon/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Home
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li><li class="masthead__menu-item">
              <a href="/ctf" >Writeups</a>
            </li><li class="masthead__menu-item">
              <a href="/blog" >Blog</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/Logo.png" alt="MiloTruck" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">MiloTruck</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Hi. I’m MiloTruck.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Singapore</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/MiloTruck" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
          
        
          
            <li><a href="https://www.linkedin.com/in/brandon-chong-286a141a2/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="An invitation [981]">
    <meta itemprop="description" content="Category: WebChallenge Description  We want you to be a member of the Cyber Defense Group! Your invitation has been encoded to avoid being detected by COViD’s sensors. Decipher the invitation and join in the fight!Starting offLooking at index.html, we open it in the browser, but nothing seems to show up on the page. We view the browser console to see an undefined variable error message in invite.js, imported through a &lt;script&gt; tag. For jquery-led.js, it appears as decently well written and formatted code, with the author credited and license mentioned as well. After a little Googling, we quickly discover that it is an open-source plug-in, here. We can conclude these are likely not needed to be reversed, and instead it is invite.js that does, being related to the challenge name as well.Breaking down invite.jsRather than handling the mess of obfuscation entirely manually, we can put it into an automatic formatter. For JavaScript, we can just use beautifier.io. The beautified code looks like this:try {    canvas = document[&#39;querySelector&#39;](&#39;.G&#39;);    gl = canvas[&#39;getContext&#39;](&#39;webgl&#39;);    gl[&#39;clearColor&#39;](0.0, 0.0, 0.0, 1.0);    gl[&#39;clear&#39;](gl.COLOR_BUFFER_BIT);    shade = canvas[&#39;getAttribute&#39;](&#39;shade&#39;);    ctype = canvas[&#39;getAttribute&#39;](&#39;type&#39;);    cid = canvas[&#39;getAttribute&#39;](&#39;id&#39;)[&#39;slice&#39;](5, 7);    gl[&#39;KG&#39;] = window[shade + cid + ctype];} catch (err) {}var _0x55f3 = [&#39;||||||function|var||hhh||||for|charCodeAt|if|length|eee||uuu||mmm|||custom|fromCharCode|String|vvv||ggg|location|catLED|type||color||rounded|font_type|background_color|e0e0e0|size|return|zzz|FF0000|value|seed|yyy|rrr||ooo|slice|ttt|false|window|else|you|iii|let|YOU||compare|0xff|||23|re|hostname|console|||57|protocol|file|54|log|max|Math|98|requestAnimationFrame|true|0BB|00|88|09|0FZ|02|0D|06HD|03S|31|get|new|Image|Object|defineProperty|id|unescape|invited|2000|pathname|const|ech||setTimeout|WANT|WE|custom3|custom2|INVITED|RE|custom1|debugger|1000|invite|the|accepting|alert|Thank|indexOf|go|118|3V3jYanBpfDq5QAb7OMCcT|leaHVWaWLfhj4|atob&#39;, &#39;toString&#39;, &#39;replace&#39;, &#39;x=[0,0,0];1C Y=(a,b)=&gt;{V s=\&#39;\&#39;;d(V i=0;i&lt;1e.1d(a.g,b.g);i++){s+=q.p((a.e(i)||0)^(b.e(i)||0))}F s};f(u.19==\&#39;1a:\&#39;){x[0]=12}S{x[0]=18}f(Y(R.u.14,&quot;T\&#39;13 1z!!!&quot;)==1y(&quot;%1E%1j%1q%17%1p%1o%1n%1m%1l%1i@M&quot;)){x[1]=1k}S{x[1]=1r}6 K(){7 j=Q;7 G=1t 1u();1v.1w(G,\&#39;1x\&#39;,{1s:6(){j=1h;x[2]=1b}});1g(6 X(){j=Q;15.1c(&quot;%c&quot;,G);f(!j){x[2]=1f}})};K();6 N(J){7 m=Z;7 a=11;7 c=17;7 z=J||3;F 6(){z=(a*z+c)%m;F z}}6 U(h){P=h[0]&lt;&lt;16|h[1]&lt;&lt;8|h[2];L=N(P);t=R.u.1B.O(1);9=&quot;&quot;;d(i=0;i&lt;t.g;i++){9+=q.p(t.e(i)-1)}r=1Z(&quot;1X//k/1Y=&quot;);l=&quot;&quot;;f(9.O(0,2)==&quot;1V&quot;&amp;&amp;9.e(2)==1W&amp;&amp;9.1U(\&#39;1D-c\&#39;)==4){d(i=0;i&lt;r.g;i++){l+=q.p(r.e(i)^L())}1S(&quot;1T T d 1R 1Q 1P!\n&quot;+9+l)}}d(a=0;a!=1O;a++){1N}$(\&#39;.1M\&#39;).v({w:\&#39;o\&#39;,y:\&#39;#H\&#39;,C:\&#39;#D\&#39;,E:10,A:5,B:4,I:&quot; W\&#39;1L 1K! &quot;});$(\&#39;.1J\&#39;).v({w:\&#39;o\&#39;,y:\&#39;#H\&#39;,C:\&#39;#D\&#39;,E:10,A:5,B:4,I:&quot;                 &quot;});$(\&#39;.1I\&#39;).v({w:\&#39;o\&#39;,y:\&#39;#H\&#39;,C:\&#39;#D\&#39;,E:10,A:5,B:4,I:&quot;   1H 1G W!  &quot;});1F(6(){U(x)},1A);&#39;, &#39;\w+&#39;];(function(_0x92e4x2, _0x92e4x3) {    var _0x92e4x4 = function(_0x92e4x5) {        while (--_0x92e4x5) {            _0x92e4x2[&#39;push&#39;](_0x92e4x2[&#39;shift&#39;]());        }    };    _0x92e4x4(++_0x92e4x3);}(_0x55f3, 0x65));var _0x3db8 = function(_0x92e4x2, _0x92e4x3) {    _0x92e4x2 = _0x92e4x2 - 0x0;    var _0x92e4x4 = _0x55f3[_0x92e4x2];    return _0x92e4x4;};var _0x27631a = _0x3db8;gl[&#39;KG&#39;](function(_0x92e4x5, _0x92e4x8, _0x92e4x9, _0x92e4xa, _0x92e4xb, _0x92e4xc) {    var _0x92e4xd = _0x3db8;    _0x92e4xb = function(_0x92e4xe) {        var _0x92e4xf = _0x3db8;        return (_0x92e4xe &lt; _0x92e4x8 ? &#39;&#39; : _0x92e4xb(parseInt(_0x92e4xe / _0x92e4x8))) + ((_0x92e4xe = _0x92e4xe % _0x92e4x8) &gt; 0x23 ? String[&#39;fromCharCode&#39;](_0x92e4xe + 0x1d) : _0x92e4xe[_0x92e4xf(&#39;0x0&#39;)](0x24));    };    if (!&#39;&#39; [_0x92e4xd(&#39;0x1&#39;)](/^/, String)) {        while (_0x92e4x9--) {            _0x92e4xc[_0x92e4xb(_0x92e4x9)] = _0x92e4xa[_0x92e4x9] || _0x92e4xb(_0x92e4x9);        }        _0x92e4xa = [function(_0x92e4x10) {            return _0x92e4xc[_0x92e4x10];        }], _0x92e4xb = function() {            var _0x92e4x11 = _0x92e4xd;            return _0x92e4x11(&#39;0x3&#39;);        }, _0x92e4x9 = 0x1;    };    while (_0x92e4x9--) {        _0x92e4xa[_0x92e4x9] &amp;&amp; (_0x92e4x5 = _0x92e4x5[_0x92e4xd(&#39;0x1&#39;)](new RegExp(&#39;\b&#39; + _0x92e4xb(_0x92e4x9) + &#39;\b&#39;, &#39;g&#39;), _0x92e4xa[_0x92e4x9]));    }    return _0x92e4x5;}(_0x27631a(&#39;0x2&#39;), 0x3e, 0x7c, _0x27631a(&#39;0x4&#39;)[&#39;split&#39;](&#39;|&#39;), 0x0, {}));Other than formatting the code, the beautifier also did some variable substitutions for us, saving us some effort. To summarise what the code does:  try setting gl.KG to a global window variable  declare a (rather large) string array variable _0x55f3  some array methods on the above string array  declare a helper function, assigned to both _0x3db8 and _0x27631a  call gl.KG as a function on an IIFE (immediately-invoked function expression)The undefined variable error found in the browser console when opening index.html, is in fact for gl, which means the try block had failed. The attributes of some elements provided in DOM (Document Object Model) of index.html don’t match up exactly with what invite.js requires. As there are only a limited number of possible global functions, in window, we can try to figure out what the function gl.KG was intended to be. A good way to do this is to look into the IIFE that was called as the argument of gl.KG.Analysing the IIFEBefore starting, we remove the try block, and put the IIFE into console.log, so we can run the Javscript as we wish. Rather than analysing from top to bottom, we trace backwards starting from the return value, _0x92e4x5. The only places that this variable appears in the IIFE are as the first parameter, in an assignment in the while loop just before returning, and of course in the return value itself. We don’t need to deal with the rest of the IIFE. (Though note that during the actual CTF, I did reverse much more of the code to get a good handle on what it really does.)With a little console.log-ing, we find that the while loop runs for exactly one iteration, and the assignment of _0x92e4x5 does occur. The .replace(regex, callback) method on String.prototype is called on the string _0x92e4x5. The intended regex takes word bounds, &#39;\b&#39; from the argument of the RegExp constructor, and the &#39;\w+&#39; from the string array, with a global flag &#39;g&#39;, forming the regex /\b\w+\b/. However, one well-known caveat of the RegExp constructor, from past experience dealing with JavaScript regexes, is the escaping. The backslashes on the word bound \b and word character \w character classes, would appear in the raw regex literal, they would have to be escaped (as \\) when in a string passed to the RegExp constructor. Simply inserting this double backslash in all three places, and running the code again, we have the argument passed to the IIFE:x=[0,0,0];const compare=(a,b)=&gt;{let s=&#39;&#39;;for(let i=0;i&lt;Math.max(a.length,b.length);i++){s+=String.fromCharCode((a.charCodeAt(i)||0)^(b.charCodeAt(i)||0))}return s};if(location.protocol==&#39;file:&#39;){x[0]=23}else{x[0]=57}if(compare(window.location.hostname,&quot;you&#39;re invited!!!&quot;)==unescape(&quot;%1E%00%03S%17%06HD%0D%02%0FZ%09%0BB@M&quot;)){x[1]=88}else{x[1]=31}function yyy(){var uuu=false;var zzz=new Image();Object.defineProperty(zzz,&#39;id&#39;,{get:function(){uuu=true;x[2]=54}});requestAnimationFrame(function X(){uuu=false;console.log(&quot;%c&quot;,zzz);if(!uuu){x[2]=98}})};yyy();function ooo(seed){var m=0xff;var a=11;var c=17;var z=seed||3;return function(){z=(a*z+c)%m;return z}}function iii(eee){ttt=eee[0]&lt;&lt;16|eee[1]&lt;&lt;8|eee[2];rrr=ooo(ttt);ggg=window.location.pathname.slice(1);hhh=&quot;&quot;;for(i=0;i&lt;ggg.length;i++){hhh+=String.fromCharCode(ggg.charCodeAt(i)-1)}vvv=atob(&quot;3V3jYanBpfDq5QAb7OMCcT//k/leaHVWaWLfhj4=&quot;);mmm=&quot;&quot;;if(hhh.slice(0,2)==&quot;go&quot;&amp;&amp;hhh.charCodeAt(2)==118&amp;&amp;hhh.indexOf(&#39;ech-c&#39;)==4){for(i=0;i&lt;vvv.length;i++){mmm+=String.fromCharCode(vvv.charCodeAt(i)^rrr())}alert(&quot;Thank you for accepting the invite!&quot;+hhh+mmm)}}for(a=0;a!=1000;a++){debugger}$(&#39;.custom1&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot; YOU&#39;RE INVITED! &quot;});$(&#39;.custom2&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;                 &quot;});$(&#39;.custom3&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;   WE WANT YOU!  &quot;});setTimeout(function(){iii(x)},2000);Now it would be sufficiently clear: This is more JavaScript code; the global function gl.KG that we want is just eval(). In the browser console, it merely gives a decoration on the page, and pauses midway in the debugger. Removing the debugger statement, a message appears through the jquery-led.js plug-in - but still no sign of the flag. Perhaps we need to take a closer look at the code rather than a cursory skim. Again, into beautifier.io it goes.x = [0, 0, 0];const compare = (a, b) =&gt; {    let s = &#39;&#39;;    for (let i = 0; i &lt; Math.max(a.length, b.length); i++) {        s += String.fromCharCode((a.charCodeAt(i) || 0) ^ (b.charCodeAt(i) || 0));    }    return s;};if (location.protocol == &#39;file:&#39;) {    x[0] = 23;} else {    x[0] = 57;}if (compare(window.location.hostname, &quot;you&#39;re invited!!!&quot;) == unescape(&quot;%1E%00%03S%17%06HD%0D%02%0FZ%09%0BB@M&quot;)) {    x[1] = 88;} else {    x[1] = 31;}function yyy() {    var uuu = false;    var zzz = new Image();    Object.defineProperty(zzz, &#39;id&#39;, {        get: function() {            uuu = true;            x[2] = 54;        }    });    requestAnimationFrame(function X() {        uuu = false;        console.log(&quot;%c&quot;, zzz);        if (!uuu) {            x[2] = 98;        }    })};yyy();function ooo(seed) {    var m = 0xff;    var a = 11;    var c = 17;    var z = seed || 3;    return function() {        z = (a * z + c) % m;        return z;    }}function iii(eee) {    ttt = eee[0] &lt;&lt; 16 | eee[1] &lt;&lt; 8 | eee[2];    rrr = ooo(ttt);    ggg = window.location.pathname.slice(1);    hhh = &quot;&quot;;    for (i = 0; i &lt; ggg.length; i++) {        hhh += String.fromCharCode(ggg.charCodeAt(i) - 1)    }    vvv = atob(&quot;3V3jYanBpfDq5QAb7OMCcT//k/leaHVWaWLfhj4=&quot;);    mmm = &quot;&quot;;    if (hhh.slice(0, 2) == &quot;go&quot; &amp;&amp; hhh.charCodeAt(2) == 118 &amp;&amp; hhh.indexOf(&#39;ech-c&#39;) == 4) {        for (i = 0; i &lt; vvv.length; i++) {            mmm += String.fromCharCode(vvv.charCodeAt(i) ^ rrr())        }        alert(&quot;Thank you for accepting the invite!&quot;+hhh+mmm);    }}// for(a=0;a!=1000;a++) { debugger }$(&#39;.custom1&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;YOU &#39;RE INVITED! &quot;});$(&#39;.custom2&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;                 &quot;});$(&#39;.custom3&#39;).catLED({type:&#39;custom&#39;,color:&#39;#FF0000&#39;,background_color:&#39;#e0e0e0&#39;,size:10,rounded:5,font_type:4,value:&quot;   WE WANT YOU!  &quot;});setTimeout(function(){iii(x)},2000);This time it is helpful to go through the code progressively. First a length 3 array x[] has its elements assigned:  x[0] is set to 23 or 57  x[1] is set to 88 or 31  x[2] is set to 54 or 98The function iii() is called on the array x[] through a setTimeout(). Within it, we see an alert() that gives user interaction, we can expect that this is where we finish, and get the flag, so we seek to find the values of hhh and mmm. For hhh, a check is performed to ensure it starts with &quot;gov*ech-c&quot; where the asterisk is any character. This is just part of the flag format, so the important bit comes from mmm. We can remove the parts involving hhh and ggg, then run the code on each of the 8 possible arrays x[], console.log-ing the value of mmm each time. The array [57,88,54] is the only one that gives a readable string for mmm: {gr33tz_w3LC0m3_2_dA_t3@m_m8}Flag: govtech-csg{gr33tz_w3LC0m3_2_dA_t3@m_m8}">
    <meta itemprop="datePublished" content="December 12, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">An invitation [981]
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#challenge-description">Challenge Description</a></li>
  <li><a href="#starting-off">Starting off</a></li>
  <li><a href="#breaking-down-invitejs">Breaking down invite.js</a></li>
  <li><a href="#analysing-the-iife">Analysing the IIFE</a></li>
</ul>
            </nav>
          </aside>
        
        <p><strong>Category:</strong> Web</p>

<h2 id="challenge-description">Challenge Description</h2>

<blockquote>
  <p>We want you to be a member of the Cyber Defense Group! Your invitation has been encoded to avoid being detected by COViD’s sensors. Decipher the invitation and join in the fight!</p>
</blockquote>

<h2 id="starting-off">Starting off</h2>

<p>Looking at <code class="language-plaintext highlighter-rouge">index.html</code>, we open it in the browser, but nothing seems to show up on the page. We view the browser console to see an undefined variable error message in <code class="language-plaintext highlighter-rouge">invite.js</code>, imported through a <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> tag. For <code class="language-plaintext highlighter-rouge">jquery-led.js</code>, it appears as decently well written and formatted code, with the author credited and license mentioned as well. After a little Googling, we quickly discover that it is an open-source plug-in, <a href="https://webartdevelopers.com/blog/tag/jquery-led/">here</a>. We can conclude these are likely not needed to be reversed, and instead it is <code class="language-plaintext highlighter-rouge">invite.js</code> that does, being related to the challenge name as well.</p>

<h2 id="breaking-down-invitejs">Breaking down <code class="language-plaintext highlighter-rouge">invite.js</code></h2>

<p>Rather than handling the mess of obfuscation entirely manually, we can put it into an automatic formatter. For JavaScript, we can just use <a href="https://beautifier.io/">beautifier.io</a>. The beautified code looks like this:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="p">{</span>
    <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">[</span><span class="dl">'</span><span class="s1">querySelector</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">.G</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">gl</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">[</span><span class="dl">'</span><span class="s1">getContext</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">webgl</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">gl</span><span class="p">[</span><span class="dl">'</span><span class="s1">clearColor</span><span class="dl">'</span><span class="p">](</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
    <span class="nx">gl</span><span class="p">[</span><span class="dl">'</span><span class="s1">clear</span><span class="dl">'</span><span class="p">](</span><span class="nx">gl</span><span class="p">.</span><span class="nx">COLOR_BUFFER_BIT</span><span class="p">);</span>
    <span class="nx">shade</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">[</span><span class="dl">'</span><span class="s1">getAttribute</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">shade</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">ctype</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">[</span><span class="dl">'</span><span class="s1">getAttribute</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">cid</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">[</span><span class="dl">'</span><span class="s1">getAttribute</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">)[</span><span class="dl">'</span><span class="s1">slice</span><span class="dl">'</span><span class="p">](</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
    <span class="nx">gl</span><span class="p">[</span><span class="dl">'</span><span class="s1">KG</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">window</span><span class="p">[</span><span class="nx">shade</span> <span class="o">+</span> <span class="nx">cid</span> <span class="o">+</span> <span class="nx">ctype</span><span class="p">];</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{}</span>

<span class="kd">var</span> <span class="nx">_0x55f3</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">||||||function|var||hhh||||for|charCodeAt|if|length|eee||uuu||mmm|||custom|fromCharCode|String|vvv||ggg|location|catLED|type||color||rounded|font_type|background_color|e0e0e0|size|return|zzz|FF0000|value|seed|yyy|rrr||ooo|slice|ttt|false|window|else|you|iii|let|YOU||compare|0xff|||23|re|hostname|console|||57|protocol|file|54|log|max|Math|98|requestAnimationFrame|true|0BB|00|88|09|0FZ|02|0D|06HD|03S|31|get|new|Image|Object|defineProperty|id|unescape|invited|2000|pathname|const|ech||setTimeout|WANT|WE|custom3|custom2|INVITED|RE|custom1|debugger|1000|invite|the|accepting|alert|Thank|indexOf|go|118|3V3jYanBpfDq5QAb7OMCcT|leaHVWaWLfhj4|atob</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">toString</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">replace</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">x=[0,0,0];1C Y=(a,b)=&gt;{V s=</span><span class="se">\'\'</span><span class="s1">;d(V i=0;i&lt;1e.1d(a.g,b.g);i++){s+=q.p((a.e(i)||0)^(b.e(i)||0))}F s};f(u.19==</span><span class="se">\'</span><span class="s1">1a:</span><span class="se">\'</span><span class="s1">){x[0]=12}S{x[0]=18}f(Y(R.u.14,"T</span><span class="se">\'</span><span class="s1">13 1z!!!")==1y("%1E%1j%1q%17%1p%1o%1n%1m%1l%1i@M")){x[1]=1k}S{x[1]=1r}6 K(){7 j=Q;7 G=1t 1u();1v.1w(G,</span><span class="se">\'</span><span class="s1">1x</span><span class="se">\'</span><span class="s1">,{1s:6(){j=1h;x[2]=1b}});1g(6 X(){j=Q;15.1c("%c",G);f(!j){x[2]=1f}})};K();6 N(J){7 m=Z;7 a=11;7 c=17;7 z=J||3;F 6(){z=(a*z+c)%m;F z}}6 U(h){P=h[0]&lt;&lt;16|h[1]&lt;&lt;8|h[2];L=N(P);t=R.u.1B.O(1);9="";d(i=0;i&lt;t.g;i++){9+=q.p(t.e(i)-1)}r=1Z("1X//k/1Y=");l="";f(9.O(0,2)=="1V"&amp;&amp;9.e(2)==1W&amp;&amp;9.1U(</span><span class="se">\'</span><span class="s1">1D-c</span><span class="se">\'</span><span class="s1">)==4){d(i=0;i&lt;r.g;i++){l+=q.p(r.e(i)^L())}1S("1T T d 1R 1Q 1P!</span><span class="se">\n</span><span class="s1">"+9+l)}}d(a=0;a!=1O;a++){1N}$(</span><span class="se">\'</span><span class="s1">.1M</span><span class="se">\'</span><span class="s1">).v({w:</span><span class="se">\'</span><span class="s1">o</span><span class="se">\'</span><span class="s1">,y:</span><span class="se">\'</span><span class="s1">#H</span><span class="se">\'</span><span class="s1">,C:</span><span class="se">\'</span><span class="s1">#D</span><span class="se">\'</span><span class="s1">,E:10,A:5,B:4,I:" W</span><span class="se">\'</span><span class="s1">1L 1K! "});$(</span><span class="se">\'</span><span class="s1">.1J</span><span class="se">\'</span><span class="s1">).v({w:</span><span class="se">\'</span><span class="s1">o</span><span class="se">\'</span><span class="s1">,y:</span><span class="se">\'</span><span class="s1">#H</span><span class="se">\'</span><span class="s1">,C:</span><span class="se">\'</span><span class="s1">#D</span><span class="se">\'</span><span class="s1">,E:10,A:5,B:4,I:"                 "});$(</span><span class="se">\'</span><span class="s1">.1I</span><span class="se">\'</span><span class="s1">).v({w:</span><span class="se">\'</span><span class="s1">o</span><span class="se">\'</span><span class="s1">,y:</span><span class="se">\'</span><span class="s1">#H</span><span class="se">\'</span><span class="s1">,C:</span><span class="se">\'</span><span class="s1">#D</span><span class="se">\'</span><span class="s1">,E:10,A:5,B:4,I:"   1H 1G W!  "});1F(6(){U(x)},1A);</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="se">\</span><span class="s1">w+</span><span class="dl">'</span><span class="p">];</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x92e4x2</span><span class="p">,</span> <span class="nx">_0x92e4x3</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_0x92e4x4</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_0x92e4x5</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="nx">_0x92e4x5</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_0x92e4x2</span><span class="p">[</span><span class="dl">'</span><span class="s1">push</span><span class="dl">'</span><span class="p">](</span><span class="nx">_0x92e4x2</span><span class="p">[</span><span class="dl">'</span><span class="s1">shift</span><span class="dl">'</span><span class="p">]());</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">_0x92e4x4</span><span class="p">(</span><span class="o">++</span><span class="nx">_0x92e4x3</span><span class="p">);</span>
<span class="p">}(</span><span class="nx">_0x55f3</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">));</span>

<span class="kd">var</span> <span class="nx">_0x3db8</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_0x92e4x2</span><span class="p">,</span> <span class="nx">_0x92e4x3</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_0x92e4x2</span> <span class="o">=</span> <span class="nx">_0x92e4x2</span> <span class="o">-</span> <span class="mh">0x0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">_0x92e4x4</span> <span class="o">=</span> <span class="nx">_0x55f3</span><span class="p">[</span><span class="nx">_0x92e4x2</span><span class="p">];</span>
    <span class="k">return</span> <span class="nx">_0x92e4x4</span><span class="p">;</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">_0x27631a</span> <span class="o">=</span> <span class="nx">_0x3db8</span><span class="p">;</span>

<span class="nx">gl</span><span class="p">[</span><span class="dl">'</span><span class="s1">KG</span><span class="dl">'</span><span class="p">](</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x92e4x5</span><span class="p">,</span> <span class="nx">_0x92e4x8</span><span class="p">,</span> <span class="nx">_0x92e4x9</span><span class="p">,</span> <span class="nx">_0x92e4xa</span><span class="p">,</span> <span class="nx">_0x92e4xb</span><span class="p">,</span> <span class="nx">_0x92e4xc</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_0x92e4xd</span> <span class="o">=</span> <span class="nx">_0x3db8</span><span class="p">;</span>
    <span class="nx">_0x92e4xb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_0x92e4xe</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_0x92e4xf</span> <span class="o">=</span> <span class="nx">_0x3db8</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">_0x92e4xe</span> <span class="o">&lt;</span> <span class="nx">_0x92e4x8</span> <span class="p">?</span> <span class="dl">''</span> <span class="p">:</span> <span class="nx">_0x92e4xb</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x92e4xe</span> <span class="o">/</span> <span class="nx">_0x92e4x8</span><span class="p">)))</span> <span class="o">+</span> <span class="p">((</span><span class="nx">_0x92e4xe</span> <span class="o">=</span> <span class="nx">_0x92e4xe</span> <span class="o">%</span> <span class="nx">_0x92e4x8</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mh">0x23</span> <span class="p">?</span> <span class="nb">String</span><span class="p">[</span><span class="dl">'</span><span class="s1">fromCharCode</span><span class="dl">'</span><span class="p">](</span><span class="nx">_0x92e4xe</span> <span class="o">+</span> <span class="mh">0x1d</span><span class="p">)</span> <span class="p">:</span> <span class="nx">_0x92e4xe</span><span class="p">[</span><span class="nx">_0x92e4xf</span><span class="p">(</span><span class="dl">'</span><span class="s1">0x0</span><span class="dl">'</span><span class="p">)](</span><span class="mh">0x24</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="dl">''</span> <span class="p">[</span><span class="nx">_0x92e4xd</span><span class="p">(</span><span class="dl">'</span><span class="s1">0x1</span><span class="dl">'</span><span class="p">)](</span><span class="sr">/^/</span><span class="p">,</span> <span class="nb">String</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">_0x92e4x9</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_0x92e4xc</span><span class="p">[</span><span class="nx">_0x92e4xb</span><span class="p">(</span><span class="nx">_0x92e4x9</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">_0x92e4xa</span><span class="p">[</span><span class="nx">_0x92e4x9</span><span class="p">]</span> <span class="o">||</span> <span class="nx">_0x92e4xb</span><span class="p">(</span><span class="nx">_0x92e4x9</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">_0x92e4xa</span> <span class="o">=</span> <span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x92e4x10</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">_0x92e4xc</span><span class="p">[</span><span class="nx">_0x92e4x10</span><span class="p">];</span>
        <span class="p">}],</span> <span class="nx">_0x92e4xb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">_0x92e4x11</span> <span class="o">=</span> <span class="nx">_0x92e4xd</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">_0x92e4x11</span><span class="p">(</span><span class="dl">'</span><span class="s1">0x3</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">},</span> <span class="nx">_0x92e4x9</span> <span class="o">=</span> <span class="mh">0x1</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">_0x92e4x9</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_0x92e4xa</span><span class="p">[</span><span class="nx">_0x92e4x9</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">_0x92e4x5</span> <span class="o">=</span> <span class="nx">_0x92e4x5</span><span class="p">[</span><span class="nx">_0x92e4xd</span><span class="p">(</span><span class="dl">'</span><span class="s1">0x1</span><span class="dl">'</span><span class="p">)](</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="dl">'</span><span class="se">\</span><span class="s1">b</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">_0x92e4xb</span><span class="p">(</span><span class="nx">_0x92e4x9</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="se">\</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">g</span><span class="dl">'</span><span class="p">),</span> <span class="nx">_0x92e4xa</span><span class="p">[</span><span class="nx">_0x92e4x9</span><span class="p">]));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">_0x92e4x5</span><span class="p">;</span>
<span class="p">}(</span><span class="nx">_0x27631a</span><span class="p">(</span><span class="dl">'</span><span class="s1">0x2</span><span class="dl">'</span><span class="p">),</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="nx">_0x27631a</span><span class="p">(</span><span class="dl">'</span><span class="s1">0x4</span><span class="dl">'</span><span class="p">)[</span><span class="dl">'</span><span class="s1">split</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">|</span><span class="dl">'</span><span class="p">),</span> <span class="mh">0x0</span><span class="p">,</span> <span class="p">{}));</span>
</code></pre></div></div>

<p>Other than formatting the code, the beautifier also did some variable substitutions for us, saving us some effort. To summarise what the code does:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">try</code> setting <code class="language-plaintext highlighter-rouge">gl.KG</code> to a global <code class="language-plaintext highlighter-rouge">window</code> variable</li>
  <li>declare a (rather large) string array variable <code class="language-plaintext highlighter-rouge">_0x55f3</code></li>
  <li>some array methods on the above string array</li>
  <li>declare a helper function, assigned to both <code class="language-plaintext highlighter-rouge">_0x3db8</code> and <code class="language-plaintext highlighter-rouge">_0x27631a</code></li>
  <li>call <code class="language-plaintext highlighter-rouge">gl.KG</code> as a function on an IIFE (immediately-invoked function expression)</li>
</ul>

<p>The undefined variable error found in the browser console when opening <code class="language-plaintext highlighter-rouge">index.html</code>, is in fact for <code class="language-plaintext highlighter-rouge">gl</code>, which means the <code class="language-plaintext highlighter-rouge">try</code> block had failed. The attributes of some elements provided in DOM (Document Object Model) of <code class="language-plaintext highlighter-rouge">index.html</code> don’t match up exactly with what <code class="language-plaintext highlighter-rouge">invite.js</code> requires. As there are only a limited number of possible global functions, in <code class="language-plaintext highlighter-rouge">window</code>, we can try to figure out what the function <code class="language-plaintext highlighter-rouge">gl.KG</code> was intended to be. A good way to do this is to look into the IIFE that was called as the argument of <code class="language-plaintext highlighter-rouge">gl.KG</code>.</p>

<h2 id="analysing-the-iife">Analysing the IIFE</h2>

<p>Before starting, we remove the <code class="language-plaintext highlighter-rouge">try</code> block, and put the IIFE into <code class="language-plaintext highlighter-rouge">console.log</code>, so we can run the Javscript as we wish. Rather than analysing from top to bottom, we trace backwards starting from the return value, <code class="language-plaintext highlighter-rouge">_0x92e4x5</code>. The only places that this variable appears in the IIFE are as the first parameter, in an assignment in the <code class="language-plaintext highlighter-rouge">while</code> loop just before returning, and of course in the return value itself. We don’t need to deal with the rest of the IIFE. (Though note that during the actual CTF, I <em>did</em> reverse much more of the code to get a good handle on what it really does.)</p>

<p>With a little <code class="language-plaintext highlighter-rouge">console.log</code>-ing, we find that the <code class="language-plaintext highlighter-rouge">while</code> loop runs for exactly one iteration, and the assignment of <code class="language-plaintext highlighter-rouge">_0x92e4x5</code> does occur. The <code class="language-plaintext highlighter-rouge">.replace(regex, callback)</code> method on <code class="language-plaintext highlighter-rouge">String.prototype</code> is called on the string <code class="language-plaintext highlighter-rouge">_0x92e4x5</code>. The <em>intended</em> regex takes word bounds, <code class="language-plaintext highlighter-rouge">'\b'</code> from the argument of the <code class="language-plaintext highlighter-rouge">RegExp</code> constructor, and the <code class="language-plaintext highlighter-rouge">'\w+'</code> from the string array, with a global flag <code class="language-plaintext highlighter-rouge">'g'</code>, forming the regex <code class="language-plaintext highlighter-rouge">/\b\w+\b/</code>. However, one well-known caveat of the <code class="language-plaintext highlighter-rouge">RegExp</code> constructor, from past experience dealing with JavaScript regexes, is the escaping. The backslashes on the word bound <code class="language-plaintext highlighter-rouge">\b</code> and word character <code class="language-plaintext highlighter-rouge">\w</code> character classes, would appear in the raw regex literal, they would have to be escaped (as <code class="language-plaintext highlighter-rouge">\\</code>) when in a string passed to the <code class="language-plaintext highlighter-rouge">RegExp</code> constructor. Simply inserting this double backslash in all three places, and running the code again, we have the argument passed to the IIFE:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span><span class="kd">const</span> <span class="nx">compare</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span><span class="kd">let</span> <span class="nx">s</span><span class="o">=</span><span class="dl">''</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span><span class="nx">s</span><span class="o">+=</span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">((</span><span class="nx">a</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">)</span><span class="o">^</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">))}</span><span class="k">return</span> <span class="nx">s</span><span class="p">};</span><span class="k">if</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span><span class="o">==</span><span class="dl">'</span><span class="s1">file:</span><span class="dl">'</span><span class="p">){</span><span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">23</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">57</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hostname</span><span class="p">,</span><span class="dl">"</span><span class="s2">you're invited!!!</span><span class="dl">"</span><span class="p">)</span><span class="o">==</span><span class="nx">unescape</span><span class="p">(</span><span class="dl">"</span><span class="s2">%1E%00%03S%17%06HD%0D%02%0FZ%09%0BB@M</span><span class="dl">"</span><span class="p">)){</span><span class="nx">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">88</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="nx">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">31</span><span class="p">}</span><span class="kd">function</span> <span class="nx">yyy</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">uuu</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="kd">var</span> <span class="nx">zzz</span><span class="o">=</span><span class="k">new</span> <span class="nx">Image</span><span class="p">();</span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">zzz</span><span class="p">,</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,{</span><span class="na">get</span><span class="p">:</span><span class="kd">function</span><span class="p">(){</span><span class="nx">uuu</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">54</span><span class="p">}});</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="kd">function</span> <span class="nx">X</span><span class="p">(){</span><span class="nx">uuu</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">%c</span><span class="dl">"</span><span class="p">,</span><span class="nx">zzz</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">uuu</span><span class="p">){</span><span class="nx">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">98</span><span class="p">}})};</span><span class="nx">yyy</span><span class="p">();</span><span class="kd">function</span> <span class="nx">ooo</span><span class="p">(</span><span class="nx">seed</span><span class="p">){</span><span class="kd">var</span> <span class="nx">m</span><span class="o">=</span><span class="mh">0xff</span><span class="p">;</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="mi">11</span><span class="p">;</span><span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="mi">17</span><span class="p">;</span><span class="kd">var</span> <span class="nx">z</span><span class="o">=</span><span class="nx">seed</span><span class="o">||</span><span class="mi">3</span><span class="p">;</span><span class="k">return</span> <span class="kd">function</span><span class="p">(){</span><span class="nx">z</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="o">*</span><span class="nx">z</span><span class="o">+</span><span class="nx">c</span><span class="p">)</span><span class="o">%</span><span class="nx">m</span><span class="p">;</span><span class="k">return</span> <span class="nx">z</span><span class="p">}}</span><span class="kd">function</span> <span class="nx">iii</span><span class="p">(</span><span class="nx">eee</span><span class="p">){</span><span class="nx">ttt</span><span class="o">=</span><span class="nx">eee</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="o">|</span><span class="nx">eee</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nx">eee</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="nx">rrr</span><span class="o">=</span><span class="nx">ooo</span><span class="p">(</span><span class="nx">ttt</span><span class="p">);</span><span class="nx">ggg</span><span class="o">=</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="nx">hhh</span><span class="o">=</span><span class="dl">""</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">ggg</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span><span class="nx">hhh</span><span class="o">+=</span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">ggg</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)}</span><span class="nx">vvv</span><span class="o">=</span><span class="nx">atob</span><span class="p">(</span><span class="dl">"</span><span class="s2">3V3jYanBpfDq5QAb7OMCcT//k/leaHVWaWLfhj4=</span><span class="dl">"</span><span class="p">);</span><span class="nx">mmm</span><span class="o">=</span><span class="dl">""</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">hhh</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="dl">"</span><span class="s2">go</span><span class="dl">"</span><span class="o">&amp;&amp;</span><span class="nx">hhh</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mi">118</span><span class="o">&amp;&amp;</span><span class="nx">hhh</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="dl">'</span><span class="s1">ech-c</span><span class="dl">'</span><span class="p">)</span><span class="o">==</span><span class="mi">4</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">vvv</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span><span class="nx">mmm</span><span class="o">+=</span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">vvv</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="o">^</span><span class="nx">rrr</span><span class="p">())}</span><span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Thank you for accepting the invite!
</span><span class="dl">"</span><span class="o">+</span><span class="nx">hhh</span><span class="o">+</span><span class="nx">mmm</span><span class="p">)}}</span><span class="k">for</span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">!=</span><span class="mi">1000</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">){</span><span class="k">debugger</span><span class="p">}</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.custom1</span><span class="dl">'</span><span class="p">).</span><span class="nx">catLED</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">custom</span><span class="dl">'</span><span class="p">,</span><span class="na">color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#FF0000</span><span class="dl">'</span><span class="p">,</span><span class="na">background_color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#e0e0e0</span><span class="dl">'</span><span class="p">,</span><span class="na">size</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="na">rounded</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="na">font_type</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="na">value</span><span class="p">:</span><span class="dl">"</span><span class="s2"> YOU'RE INVITED! </span><span class="dl">"</span><span class="p">});</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.custom2</span><span class="dl">'</span><span class="p">).</span><span class="nx">catLED</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">custom</span><span class="dl">'</span><span class="p">,</span><span class="na">color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#FF0000</span><span class="dl">'</span><span class="p">,</span><span class="na">background_color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#e0e0e0</span><span class="dl">'</span><span class="p">,</span><span class="na">size</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="na">rounded</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="na">font_type</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="na">value</span><span class="p">:</span><span class="dl">"</span><span class="s2">                 </span><span class="dl">"</span><span class="p">});</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.custom3</span><span class="dl">'</span><span class="p">).</span><span class="nx">catLED</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">custom</span><span class="dl">'</span><span class="p">,</span><span class="na">color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#FF0000</span><span class="dl">'</span><span class="p">,</span><span class="na">background_color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#e0e0e0</span><span class="dl">'</span><span class="p">,</span><span class="na">size</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="na">rounded</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="na">font_type</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="na">value</span><span class="p">:</span><span class="dl">"</span><span class="s2">   WE WANT YOU!  </span><span class="dl">"</span><span class="p">});</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">iii</span><span class="p">(</span><span class="nx">x</span><span class="p">)},</span><span class="mi">2000</span><span class="p">);</span>
</code></pre></div></div>

<p>Now it would be sufficiently clear: This is more JavaScript code; the global function <code class="language-plaintext highlighter-rouge">gl.KG</code> that we want is just <code class="language-plaintext highlighter-rouge">eval()</code>. In the browser console, it merely gives a decoration on the page, and pauses midway in the debugger. Removing the <code class="language-plaintext highlighter-rouge">debugger</code> statement, a message appears through the <code class="language-plaintext highlighter-rouge">jquery-led.js</code> plug-in - but still no sign of the flag. Perhaps we need to take a closer look at the code rather than a cursory skim. Again, into <a href="https://beautifier.io/">beautifier.io</a> it goes.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">s</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">s</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">((</span><span class="nx">a</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">file:</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">57</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hostname</span><span class="p">,</span> <span class="dl">"</span><span class="s2">you're invited!!!</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">unescape</span><span class="p">(</span><span class="dl">"</span><span class="s2">%1E%00%03S%17%06HD%0D%02%0FZ%09%0BB@M</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">88</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">yyy</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">uuu</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">zzz</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">zzz</span><span class="p">,</span> <span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">get</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">uuu</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">54</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="kd">function</span> <span class="nx">X</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">uuu</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">%c</span><span class="dl">"</span><span class="p">,</span> <span class="nx">zzz</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">uuu</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">98</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">};</span>
<span class="nx">yyy</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">ooo</span><span class="p">(</span><span class="nx">seed</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">seed</span> <span class="o">||</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">z</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span> <span class="nx">z</span> <span class="o">+</span> <span class="nx">c</span><span class="p">)</span> <span class="o">%</span> <span class="nx">m</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">z</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">iii</span><span class="p">(</span><span class="nx">eee</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ttt</span> <span class="o">=</span> <span class="nx">eee</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span> <span class="nx">eee</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="nx">eee</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="nx">rrr</span> <span class="o">=</span> <span class="nx">ooo</span><span class="p">(</span><span class="nx">ttt</span><span class="p">);</span>
    <span class="nx">ggg</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">hhh</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ggg</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">hhh</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">ggg</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">vvv</span> <span class="o">=</span> <span class="nx">atob</span><span class="p">(</span><span class="dl">"</span><span class="s2">3V3jYanBpfDq5QAb7OMCcT//k/leaHVWaWLfhj4=</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">mmm</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">hhh</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">go</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">hhh</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">118</span> <span class="o">&amp;&amp;</span> <span class="nx">hhh</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="dl">'</span><span class="s1">ech-c</span><span class="dl">'</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">vvv</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">mmm</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">vvv</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">^</span> <span class="nx">rrr</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Thank you for accepting the invite!</span><span class="dl">"</span><span class="o">+</span><span class="nx">hhh</span><span class="o">+</span><span class="nx">mmm</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// for(a=0;a!=1000;a++) { debugger }</span>

<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.custom1</span><span class="dl">'</span><span class="p">).</span><span class="nx">catLED</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">custom</span><span class="dl">'</span><span class="p">,</span><span class="na">color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#FF0000</span><span class="dl">'</span><span class="p">,</span><span class="na">background_color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#e0e0e0</span><span class="dl">'</span><span class="p">,</span><span class="na">size</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="na">rounded</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="na">font_type</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="na">value</span><span class="p">:</span><span class="dl">"</span><span class="s2">YOU 'RE INVITED! </span><span class="dl">"</span><span class="p">});</span>
<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.custom2</span><span class="dl">'</span><span class="p">).</span><span class="nx">catLED</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">custom</span><span class="dl">'</span><span class="p">,</span><span class="na">color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#FF0000</span><span class="dl">'</span><span class="p">,</span><span class="na">background_color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#e0e0e0</span><span class="dl">'</span><span class="p">,</span><span class="na">size</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="na">rounded</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="na">font_type</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="na">value</span><span class="p">:</span><span class="dl">"</span><span class="s2">                 </span><span class="dl">"</span><span class="p">});</span>
<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.custom3</span><span class="dl">'</span><span class="p">).</span><span class="nx">catLED</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">custom</span><span class="dl">'</span><span class="p">,</span><span class="na">color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#FF0000</span><span class="dl">'</span><span class="p">,</span><span class="na">background_color</span><span class="p">:</span><span class="dl">'</span><span class="s1">#e0e0e0</span><span class="dl">'</span><span class="p">,</span><span class="na">size</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="na">rounded</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="na">font_type</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="na">value</span><span class="p">:</span><span class="dl">"</span><span class="s2">   WE WANT YOU!  </span><span class="dl">"</span><span class="p">});</span>
<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">iii</span><span class="p">(</span><span class="nx">x</span><span class="p">)},</span><span class="mi">2000</span><span class="p">);</span>
</code></pre></div></div>

<p>This time it is helpful to go through the code progressively. First a length 3 array <code class="language-plaintext highlighter-rouge">x[]</code> has its elements assigned:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">x[0]</code> is set to 23 or 57</li>
  <li><code class="language-plaintext highlighter-rouge">x[1]</code> is set to 88 or 31</li>
  <li><code class="language-plaintext highlighter-rouge">x[2]</code> is set to 54 or 98</li>
</ul>

<p>The function <code class="language-plaintext highlighter-rouge">iii()</code> is called on the array <code class="language-plaintext highlighter-rouge">x[]</code> through a <code class="language-plaintext highlighter-rouge">setTimeout()</code>. Within it, we see an <code class="language-plaintext highlighter-rouge">alert()</code> that gives user interaction, we can expect that this is where we finish, and get the flag, so we seek to find the values of <code class="language-plaintext highlighter-rouge">hhh</code> and <code class="language-plaintext highlighter-rouge">mmm</code>. For <code class="language-plaintext highlighter-rouge">hhh</code>, a check is performed to ensure it starts with <code class="language-plaintext highlighter-rouge">"gov*ech-c"</code> where the asterisk is any character. This is just part of the flag format, so the important bit comes from <code class="language-plaintext highlighter-rouge">mmm</code>. We can remove the parts involving <code class="language-plaintext highlighter-rouge">hhh</code> and <code class="language-plaintext highlighter-rouge">ggg</code>, then run the code on each of the 8 possible arrays <code class="language-plaintext highlighter-rouge">x[]</code>, <code class="language-plaintext highlighter-rouge">console.log</code>-ing the value of <code class="language-plaintext highlighter-rouge">mmm</code> each time. The array <code class="language-plaintext highlighter-rouge">[57,88,54]</code> is the only one that gives a readable string for <code class="language-plaintext highlighter-rouge">mmm</code>: <code class="language-plaintext highlighter-rouge">{gr33tz_w3LC0m3_2_dA_t3@m_m8}</code></p>

<p><strong>Flag:</strong> <code class="language-plaintext highlighter-rouge">govtech-csg{gr33tz_w3LC0m3_2_dA_t3@m_m8}</code></p>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-12-12T00:00:00+08:00">December 12, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=An+invitation+%5B981%5D%20http%3A%2F%2Flocalhost%3A4000%2FAn-invitation%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2FAn-invitation%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2FAn-invitation%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/A-to-Z-of-COViD!/" class="pagination--pager" title="A to Z of COViD! [1986]
">Previous</a>
    
    
      <a href="/COVID's-Communication-Technology!/" class="pagination--pager" title="COVID’s Communication Technology! [984]
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/ctf/Exploiting-smart-contracts-in-HackTM-2023-CTF-Quals/" rel="permalink">Exploiting smart contracts in HackTM 2023 CTF Quals
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  11 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">This CTF had two smart contract challenges, Dragon Slayer and Diamond Heist.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/ctf/Grey-Cat-The-Flag-Qualifiers-2022/" rel="permalink">Grey Cat The Flag Qualifiers 2022
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  7 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">This CTF was the qualifying round for Grey Cat The Flag 2022, hosted by the National University of Singapore (NUS). Under the name ItzyBitzySpider, I partici...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/CVE-2022-22010/" rel="permalink">CVE-2022-22010
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  9 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Microsoft Media Foundation CQTTrack::CreateChildAtom Information Disclosure Vulnerability (mfmp4srcsnk.dll)
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/CVE-2022-21977/" rel="permalink">CVE-2022-21977
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  8 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Microsoft Media Foundation Unchecked Size Vulnerability (mfmp4srcsnk.dll)
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://milotruck.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Blog</a></li>
        
      
        
      
        
      
        
          <li><a href="https://github.com/MiloTruck" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 MiloTruck. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
